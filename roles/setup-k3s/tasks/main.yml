---

- name: Install k3s
  shell: curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE="644" sh -s -
  become: true

- name: Chmod
  file:
    path: "{{ kubeconfig_path }}"
    mode: '0644'
  become: true

- name: Fetching kubeconfig
  fetch:
    src: "{{ kubeconfig_path }}"
    dest: fetched/kubeconfig

- name: Creating a namespace
  kubernetes.core.k8s:
    name: keycloak
    api_version: v1
    kind: Namespace
    state: present
    kubeconfig: "{{ kubeconfig_path }}"